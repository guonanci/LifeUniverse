Building smart web 2.0 applications
机器学习、计算统计为主题背景，如何挖掘和分析 Web 上的数据和资源，如何分析用户体验、市场营销、个人品味等诸多信息，得出有用的结论，通过复杂的算法
来从 Web 网站获取、收集并分析用户数据和反馈信息

内容翔实，包括协作过滤技术（实现关联产品推荐功能）、集群数据分析（大规模数据集中发现相似的数据子集）、搜索引擎核心技术（爬虫、索引、查询引擎、PageRank
算法）、搜索海量信息并进行分析统计得出结论的优化算法、贝叶斯过滤技术（垃圾邮件过滤、文本过滤）、用决策树技术实现预测和决策建模功能、社交网络的信息匹配技术、机器学习和人工智能应用

Web 开发者、架构师、应用工程师等的绝佳选择

为了满足读者对网络和软件技术知识的迫切需求，世界著名计算机图书出版 机构 O'Reilly Media, Inc. 授权电子工业出版社，翻译出版一批族公司久负盛 名的英文经典技术专著。
O'Reilly Media,Inc. 是世界上在 Unix、 X、 Intemet 和其他开放系统图书领域 具有领导地位的出版公司，同时也是在线出版的先锋。

许多书店的反馈表明， O'Reilly Media, Inc 是最稳定的计算机图书出版商一一 每一本书都一版再版。与大多数计算机图书出版商相比， O'ReillyMedia,Inc. 具有深厚的计算机专业背景，这使得 O'Reilly Media, Inc. 形成了一个非常不 同于其他出版商的出版方针。

O'Reilly Media, Inc. 所有的编辑人员以前都是 程序员，或者是顶尖级的技术专家。 O'Reilly Media, Inc.还有许多固定的作者 群体-→ 也们本身是相关领域的技术专家、咨询专家，而现在编写著作， O'ReilJy Media,Inc.依靠他们及时地推出图书。因为 O'ReillyMedia,Inc.紧密 地与计算机业界联系着，所以 O'Reilly Media, Inc. 知道市场上真正需要什么
图书。

每年我都要审阅几本图书，自然而然地.在工作当中我阅读了大量的书籍。不得不承认， 阅读本书让我获得了以前从未有过的、相当愉悦的阅读体验。太棒了!对于初学这些算兹 的开发者而 言 ，我想不出有比这本书更好的选择了.而对于像我这样学过 AI 的老朽而言， 我也想不出还有什么更好的办怯能够让自己重温这些知识的细节。"
一-Dan Russel1.资深技术经理. Google
"Toby 的这本书非常成功地将机吉普学习算怯这一复杂的议题拆分成了 一个个既实用叉易懂 的例子 ，我们可以直接利用这些例子来分析当前网络上的社会化交直作用。我要是早两年 读过这本书，就会省去件多宝贵的时间，也不至于走那么多的弯路了 J

- - T i m Wolters . CTO. Collective lntel1ect

"本书获得了巨大的成功，它为大量相关数据的处理提供了 非常丰富的计算方法. 更重要 的是，它将这些技术应用到了互联网上，而不是在一个个彼此孤立的数据孤岛中寻求价值。 如果你是在为互联网开发应用，那么本书将是你的不二之选 J
一-Paul Tyma. 高级软件工程师. Google

# 译者序

还记得上个世纪 90 年代，当大学校院里的学子们还在为能够通过对等网在不同计算机间相互发送消息而兴奋不已的时候，互联网就已经悄然兴起了。很快，人从就从 C/S 时代跨入 B/S 时代了。我们不必再担心每次都要安装复杂的客户端程序，只要有浏览器，就会有绚丽多彩的舞台 j
然而随着时间的推移，人们叉开始有所回归，大家不时地抱怨:为什么不 能让浏览器像客户端应用那样具有丰富的表现?为什么每次打开链接都要傻傻地等着空白 页面消失?直到有一 天 ， Tim O'Reilly 向世人宜告了 一个新的概念一-Web 2.0. 于是，忽 如一夜春风来，大大小小的 Web2.0 应用如雨后春笋般不断涌现， 互联网又迈向了 一个新的 时代。

本书以 Web2.0 的核心价值观一一集体智嚣作为出发点，探讨了各种能够让 Web2.0 程序变 得更为智能的算法及其应用。这些算法大多来自机器学习和计算统计领域 ， 其中的一些算 法非常普及，而另一些贝 1I 属于 目前相当前梅的课题。它们包括了过滤器、聚类算法 、支持 向量机、遗传编程、优化技术，以及非常著名的 PageRank 算兹，等等.将如此众多的优秀 算在各有效应用于直联网领域，并构造出具有智能特征的 Web2.0 应用， 应该是本书的一大亮 点，同时，这也使本书有别于以往我们所见到过的任何一本纯粹介绍 Web2.0 技术与概念的 书籍.

特在此附上本书翻译过程中整理提取的中英文术语对照表。下表 所包含的多为专业领域的技术术语。其中部分术语在不同的文献中往往有不同的译法。本 书为了统一，选择了比较常见的译法.如 cIustering 可译作"聚类"或"聚集"，此处我们 选择了"聚类"。类似的还有 k-nearestneighbors、 cross-product、 dot-product，等等。

另一部分术语，虽有固定译法，但我们结合上下文，采用了更为贴切的翻译。如 computation­ ally intensive 常被译为"计算密集的"，而在此处，我们采用"计算盘很大的"。类似的还有 data-intensive、 solution、 crawl，等等。
此外还有一部分术语，在当下的中文文献中并没有明确的公认译烛，因而我们在书中给出 了参考翻译，以供大家商榷。如 collectiveintelligence 被译为"集体智慧"， listcomprehension
被译为"列表推导式"，等等。

clustering 聚类,computationally intensive 计算量很大的,cross-product 叉乘,dendrogram 树状图,groups 群组,kernel methods 核方法,kernel tricks 核计法;k-nearest neighbors K-最近邻,multidimensional scaling 多堆缩放,pattern 模式,solution 解,collective intelligence,crawl 网页搜索,data-intensive 数据量很大的,dot-product 点积,inbound link,incoming link 外部回指链接；K-Means,list comprehension K 均值 列表推导式;observations 观测数据、观测值;similarity 相似度相似性;vertical search engine 垂直搜索引擎;

无论是有意还是无意，越来越多投身子互联网的人们已经制造出了相 当多的数据，这给了 我们无数潜在的机会来洞悉用户体验、商业营销、个人偏好和通常所谓的人类行为 (human behavior)。本书向大家介绍了一个新兴的领域，称为集体宿慧 (collective intelligence)。这 一领域涵盖了诸多方法.借助这些方法我们可以从众多 Web 站点处(这些站点的名字或 i 午 你曾经有所耳闻)提取到值得关注的重要数据 g 借助这些方站我们还可以从使用自己应用 程序的用户那里搜集信息，并对我们所掌握的数据进行分析和理解.
本书并不假设你已经具备了任何有关数据分析、机器学习或统计学方面的知识。笔者在尝试以尽可能浅显易懂的方式来解释数学概念，不过具备一点三角学和统计学的基本知识将会对你理解算法有所助益。

# 示例风格

本书每一章节的代码都是以一种教程式风格编写而成，他鼓励你以循序渐进的方式来构建应用程序，并对算法的工作原理有一个深入的理解和认识。交互，变体，多种
以交互的方式

# 为何选择 Python

书中的算法是伴随着对相关公式的解释，以文字形式加以描述的，但是假如有针对算法和示例问题的实际代码，那将会是更有助益的（而且有可能更易于理解）。Python 是一种优秀的高级语言

- 简练
  - 在完成示例的过程中会有更少的录入工作，我们将更容易记住算法并真正领会算法的原理
- 易于阅读
  - Python 不时被人们指为「可执行的伪代码」。虽然很明显这是一种夸大之词，但是它表明，
    Python 可以直接从命令行运行程序，它还有交互提示，允许我们键入函数调用、创建对象，并以交互的形式来对包进行测试。
    多范式
    Python 支持面向对象、过程式和函数式编程风格。机器学习算法千差万别，最为清晰的做法是针对不同算法采用不同范式，有时将函数作为参数传入很有用处，而有时
    我们则需要在对象中捕获状态，对于这两种方式，Python 均予以支持。

## 多平台和免费

Python 有一个针对所有主流平台的单一参考实现，并且他对所有平台都是免费的。本书中所列代码可以运行于 Windows、Linux、Macintosh 环境

对于有兴趣学习 Python 编程的初学者而言，笔者推荐大家阅读由 Mark Lutz 与 David Ascher 合著的《Learning Python》（O'Reilly)。该书有对 Python 的全面论述。为了更为直观地表达算法或基础性概念，笔者在整本书中使用了一些 Python 特有的语法，但是其他语言的程序员会发现，Python 比较容易掌握。

为非 Python 程序员提供的一份快速概览：

- 列表和字典的构造函数
  Python 有一组不错的基本类型，其中有两种类型在本书中被大量使用，分别是列表和字典。列表是由一组任意类型的值构成的有序列表。由方括号构造而成。
  字典是由一组键（名）值对构成的无序集合，类似于其他语言的 hash map。大括号 ages={'John':24,'Sarah':28}

  可以通过序列名后跟方括号的形式来访问列表和字典中的元素：

  ```python
  string_list[2] # returns 'c'
  ages['Sarah'] # returns 28

  ```

  有意义的空白字符
  与大多数语言有所不同，Python 实际上是利用代码锁紧来定义代码块的。

```python
if s==1:
  print 'x is 1'
  print 'Still in if block'
print 'outside if block'
```

因为代码是被缩进的，所以语法解释器知道前两个语句会在 x 为 1 的时候被执行。缩进可以是任意数量的空格，只要是常量。本书是两个空格，输入代码时我们必须正确拷贝缩进。

## 列表推导式 list comprehension

方便简洁的语法形式，将一个列表经过滤后转换成另一个列表，也可以利用它将函数应用于列表中元素。列表推导式以如下形式书写：
`[expression for variable in list]`
or
`[expression for variable in list if condition]`

```python
l1=[1,2,3,4]
print [v*10 for v in l1 if v<4]
# [10,20,30]
```

本书频繁使用列表推导式，因为要将一个函数应用于整个列表，货是删除不需要的列表项时，这种表达方法非常简练。列表推导式的另一种常见用法是与 dict 构造函数结合在一起使用：

```python
l1=[1,2,3,4]
timesten=dict([(v,v*10) for v in l1])
# 上述代码将会建立一个字典，以原先的列表作为键，以每个列表项乘以10作为值：
[1:10,2:20,3:30,4:40]
```

## 开放的 API

用于将集体智慧合成起来的许多算法需要来自许多用户的数据。除机器学习算法外，本书还讨论了许多开放的 Web APIs（应用编程接口）。这些 API 允许我们通过特殊协议对来自相应 web 站点的数据进行访问；我们可以将数据下载下来并加以处理。这些数据通常是有站点使用者来提供的，我们可以从中挖掘出心内喊来。有时候，我们可以用现成的 Python 库来访问这些 API；有时如果没有现成库，那么最为直接的做法莫过于创建自己的接口来访问数据，为此我们需要利用 Python 提供的内建库将数据下载下来，并对 XML 加以解析
此处列出了一些列提供开放 API 的 web 站点，我们将在本书中陆续接触到这些站点。
del.icio.us
一个社会性书签应用系统 social bookmarking application，其开放的 API 允许你根据 tag 或特定用户来下载链接
Kayak
一个提供 API 的旅游网站，利用 API 在自己的程序中集成针对航班和旅馆的搜索
eBay
一个提供 API 的在线交易站点，允许你查询当前正在出售的货品
Hot or Not
一个评分与交友的网站，提供 API 对人员进行搜索，并获取其评分、个人资料。
Akismet
一种用于对协作型垃圾信息进行过滤的 API
通过对来自单一源的数据进行处理，对来自多个源的数据进行组合，甚至通过将外部信息与自有系统的用户输入信息加以组合，我们可以构造出大量的潜在应用。对人们在不同网站以各种不同方式产生的数据家以充分利用的能力，便是构成集体智慧的一个基本要素。

如果你想寻找更多的提供开放 API 的 web 站点，不妨从访问 ProgrammableWeb 开始 http://www.programmableweb.com

# 各章概览

本书的每个算法都来源于某一现实问题，希望这些问题能够很容易地被广大读者所理解。笔者将尝试尽量避开那些要求大量领域知识的问题，而将焦点集中在那些虽不失复杂性，但对大多数涉足这而言却又是简单简单移动的问题上。

## 第 1 章集体智慧导言

蕴藏于机器学习背后的概念，并解释了如何将其应用于诸多不同的领域，以及如何利用它来搜集自许多不同人群的数据进行分析，并从中得出新结论。

## 2 提供推荐

协作型过滤 collaborative filtering，这项技术被许多在线零售商店用来向顾客推荐商品或媒体。本章有一节介绍了如何向一个社会型书签服务服务网站的用户提供推荐链接，还介绍了如何根据 MovieLens 所提供的数据几构筑一个影片推荐系统。

## 3 发现群组

本章基于第 2 章中给出的某些观点，介绍了两种不同的聚类方法，利用这些方法，我们可以在一个大数据集中自动找出具有相似特征的群组。还演示了如何利用聚类算法从一组颇受欢迎的博客之中寻找群组，以及利用聚类算法根据某个社会型网站的用户意愿去寻找群主

## 4 搜索与排名

**构成一个搜索引擎的各个不同组成部分，他们包括：爬虫程序 crawler，索引程序 indexer，query engine.介绍了以来自外部网站的链接信息为依据给网页打分的 PageRank 算法，还向你展示了如何构建神经网络，借此获知与不同结果相关联的关键词**。

## 5 优化

优化算法的目的，是为了对问题的书百万个可能的题解今性搜索，从中选出最优解。展示了这些算法的各种不同用法：包括：为一群去往相同地点的旅客寻找最佳航班，寻找为学生安排宿舍的最佳方案，以及给出交叉线数量最小的网络布局。

# 6 文档过滤

演示了贝叶斯过滤，被广泛应用于许多免费的和商业的垃圾信息过滤系统中，用于根据单词类型以及出现在文档中的其他特征对文档进行自动分类。应用于一组 RSS 搜索结果，以此来说明对内容项的自动分类过程。

# 决策树建模

决策树，我们不仅将他作为一种预测方法，而且还用它来为决策过程进行建模。本章中出现的第一棵决策树是根据假象的服务器日志数据构建而成，我们利用它来预测用户是否有可能成为付费订户 premium subscriber。本征的另一个例子使用了来自真实 web 站点的数据，对住房价格和来自 Hot or Not 的‘热度 hotness’评价进行建模

# 8 构建价格模型

解决的是数值预测问题而非分类问题，期间用到了**k-最近邻技术**，并且还用到了第 6 章中的优化算法。我们将这些方法与 eBay API 结合在一起构造出一个系统，能够根据拍卖品的一组属性，预测出最终的拍卖价格。

# 9 高阶分类：核方法与 SVM

本章向读者介绍了如何利用 **支持向量机 support-vector machines**对在线约会网站的用户进行匹配，以及如何将其用于针对专业交友网站的友好信息搜索。非常高阶的技术

# 10 寻找独立特征

相对较新的技术，非负矩阵因式分解 non-negative matrix factorization，。可以在数据集中寻找出独立的特征。

**对于许多数据集而言，其中所包含的内容都是可以借助一组独立特征的组合被重新构造出来的，而这些特征是我们事先不知道的，非负矩阵因式分解的思路便是要寻找这些特征。在本章中，我们利用一组新闻报道说明了这项技术的使用；**
期间，通过新闻故事来寻找其中的主题，一篇给定的新闻故事中会包含一个或多个这样的主题

# 11 智能进化

遗传编程 genetic programming，一组非常复杂的技术，超出了优化的范畴。实际上借鉴了进化的思想，通过自动构造算法的方式来解决特定问题。我们通过简单的游戏来说明这项技术的应用，在游戏中，计算机最初只是学艺不精的初级选手，但是随着游戏的不断进行，他会通过逐步改进其所拥有的代码来提升自己的技能

# 12 算法总结

回顾书中所讲述的所有机器学习算法及统计算法，并将他们与一组人为设计的问题做了对比。这将有助于我们理解算法的工作原理，并形象地说明每种算法划分数据的方法。

# 附录 A：第三方函数库

给出了有关本书所用的第三方库信息，例如在哪里可以找到这些第三方函数库，以及如何进行安装。

# 附录 B：包含了一部分数学公式及其说明，以及本书通篇引入的，以代码形式描述的诸多数学概念。

位于每章末尾处的练习，为读者提供了许多相关信息，借此我们可以对算法进行扩展并使其变得更强大。

排版约定：
普通字体：指示菜单标题、菜单选项、菜单按钮，以及键盘快捷键（诸如 Alt 和 Ctrl）
斜体 Italic：
指示新术语、URL、Email 地址、文件名、文件扩展名、路径名、目录、以及 Unix 工具。
等宽字体：用于指示命令 commands、命令选项 options、开关 switches、变量 variables、属性 attributes，键值 keys、函数 functions、类型 types、类 classes、namespaces，方法 methods，模块 modules，成员属性 properties，参数 parameters，值 values，对象 objects，事件 events，事件处理器 event handlers，XML 标签，HTML 标签，宏、文件内容或命令的输出结果

等宽粗体：命令或者其他应该由用户手工逐字输入的文本。
等宽斜体：可替换文本，这些文本应该被替换成用户提供的内容

通过引用书中内容及示例代码的方式来答疑解难是无需许可的。将书中的大量示例代码加入到你的产品文档中则是需要许可的

引用时注明出处，我们将不胜感激但是并非必须，引用通常包含标题作者出版商以及 ISBN 号。例如’Programming Collective Intelligence by Today Segaran. Copyright 2007 Toby Segaran, 978-0-596-52932-1'.

如果你发现自己对示例代码的使用有失公允或违反了上述条款

Toby Segaran 是 Genstruct 公司的软件开发主管，这家公司涉足计算生物领域，他本人的职责是设计算法，并利用数据挖掘技术来辅助了解药品机理。Toby Segaran 还为其他几家公司和数个开源项目服务。帮助他们从收集到的数据当中分析发掘价值。除此以外，Toby Segaran 还建立了几个免费的网站应用，包括流行的 tasktoy 和 Lazybase。非常喜欢滑雪和品酒，其博客地址是 blog.kiwitobes.com 现居于旧金山。

巴塔哥尼亚 Patagonia。王企鹅并非产于南美洲，他们在那里的最后一篇栖息地早在 19 世纪就已经被海豹狩猎者给摧毁了。次南极群岛一带，爱德华王子、克罗泽特、Macquarie、Falkland Islands。海滨、靠近大海的地势平坦的冰川地区群居性鸟类，在他们的繁殖地，种群数量多达 1 万，而且他们时常聚集在一起饲养幼鸟

王企鹅站立时有 76.2 厘米（30 英寸）高，体重达到 13.6 千克（30 磅），他们是企鹅家族中体型最大的种群之一 --- 仅次于其近邻帝企鹅

# **目录**

# 前言

# 1 集体智慧导言

什么是集体智慧
什么是机器学习
局限
例子
学习型算法的其他用途

# 2 提供推荐

协作型过滤
搜集偏好
寻找相近的用户
推荐物品
匹配商品
构建一个基于 del.icio.us 的链接推荐系统
基于物品的过滤
使用 MovieLens 数据集
基于用户进行过滤还是基于物品进行过滤

# 3 发现群组

监督学习和无监督学习
单词向量
分级聚类
绘制树状图
列聚类
K-均值聚类
针对偏好的聚类
以二维形式展现数据
有关聚类的其他事宜

# 4 搜索与排名

搜索引擎的组成
一个简单的爬虫程序
建立索引
查询
基于内容的排名
利用外部回指链接
从点击行为中学习

# 5 优化

组团旅游
描述题解
成本函数
随机搜索
爬山法
模拟退火算法
遗传算法
真实的航班搜索
设计偏好的优化
网络可视化
其他可能的应用场合

# 6 文档过滤

过滤垃圾信息
文档和单词
对分类词进行训练
计算概率
朴素分类器
费舍尔方法
将经过训练的分类器持久化
过滤博客订阅源
对特征检测的改进
使用 Akismet
替代方法

# 7 决策树建模

预测注册用户
引入决策树
对数进行训练
选择最合适的拆分方案
以递归方式构造树
决策树的显示

# 8 构建价格模型

本章解决的是数值预测而非分类问题，期间用到了 **k-最近邻技术**，并且还用到了第 5 章中的优化算法。我们将这些方法与 eBay API 结合在一起构造出一个系统，能够根据拍卖品的一组属性，预测出最终的拍卖价格

# 9 高阶分类：核方法与 SVM

如何利用支持向量机 support-vector machines 对在线约会网站的用户进行匹配，以及如何将其用于针对专业交友网站的好友信息搜索。支持向量机是一项非常高阶的技术，

# 13.357
