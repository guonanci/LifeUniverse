#第3章
##报文组成
###语法
请求报文格式：
<method> <request-URL> <version>
<headers>

<entity-body>
响应报文
<version> <status> <reason-phrase>
<headers>

<entity-body>

<method> 客户端希望服务器对资源执行的动作,是一个单独的词.比如 GET, HEAD, POST AND SO ON...

<request-URL> 命名了所请求资源,或者 URL 路径组件的的完整 URL.

<version> 报文所使用的 http 版本,HTTP/<major>.<minor>
主要版本号和次要版本号都是整数

<status-code>
这三位数字描述了请求过程中所发生的情况,第一位数字用于描述状态的一般类别(成功,出错)

<reason-phrase> 数字状态码的可读版本,包含行终止序列之前的所有文本,只是对 status-code 进行补充,更方便理解.
###起始行
所有的 http 报文都已一个起始行作为开始,请求报文的起始行说明了要做些什么,响应报文的起始行说明发生了什么.
####请求行
请求报文请求服务器对资源进行一些操作.请求报文的起始行(请求行),包含了一个方法和一个请求 URL,这个方法描述了服务器应该执行的操作,请求 URL 描述了要对哪个资源执行该方法,请求行中还包括http版本,用来告知服务器客户端使用哪种 http.
所有这些字段都有空个字符分隔.
####响应行
响应报文承载了状态信息和操作产生的所有结果数据,将其返回给客户端,响应行包含了响应报文使用的 http 版本,数字状态码,以及描述操作状态的文本形式的原因短语.
####方法
GET 从服务器获取一份文档
HEAD 只从服务器获取文档的首部
POST 向服务器发送需要处理的数据
PUT 将请求的主体部分存储在服务器上
TRACE 对可能经过代理服务器传送到服务器上去的报文进行追踪
OPTIONS 决定可以在服务器上执行哪些方法
DELETE 从服务器上删除一份文档
####状态码
方法是用来告诉服务器做什么事情,状态码用来告诉浏览器发生了什么事情.
浏览器向一个 http 服务器发送请求报文时,会发生许多事情.可能会成功,但是也有可能无法找到所请求的资源,没有访问资源的权限,或者资源被移动到了其他地方.

数字码便于程序进行差错处理.
整体范围 已定义范围 分类
100-199 100-101 信息提示
200-299 200-206 成功
300-399 300-305 重定向,资源已经被移走了
400-499 400-415 浏览器请求出错
500-599 500-505 服务器出错

现在只为每类状态定义了几个数字码,以后随着协议的发展, http 规范中会正式地定义更多的状态码.

200 OK 成功,请求的所有数据都在响应主体中
401 Unauthorized(未授权) 需要输入用户名和密码
404 Not Found 服务器无法找到请求 URL 对应的资源
###首部
####分类
- 通用首部,即可以出现在请求报文又可以出现在响应报文,提供了与报文相关的最基本的信息.不论报文是何种类型,都为其提供一些有用信息.

Connection 允许浏览器和服务器指定与请求/响应连接有关的选项
Date 提供日期和时间标志,说明报文是什么时间创建的
MIME-Version 给出了发送端使用的 MIME 版本
Trailer 如果报文采用了分块传输编码方式(chunked transfer encoding),就可以用这个首部列出位于报文尾部(trailer)的首部集合.
Transfer-Encoding 告知接收端为了保证报文的可靠传输,对报文采用了什么编码方式
Update 给出了发送端可能想要升级使用的新版本或者协议
Via 显示了报文经过的中间节点(代理, 网关)



这些是浏览器和服务器都可以使用的通用首部,可以在浏览器,服务器和其他应用程序之间提供一些非常有用的通用功能.比如 Date 首部,每一段都可以用它来说明构建报文的时间和日期:
Date: Tue, 3 Oct 1999 02:16:00 GMT

- 请求首部,提供更多有关请求的信息,只在请求报文中有意义的首部.用于说明是谁或者什么在发送请求,请求源来自何处,或者浏览器的喜好及能力.服务器可以根据请求首部给出的浏览器信息,试着为浏览器提供更好的响应.下面列出请求的信息性首部

Client-IP 提供了运行浏览器的机器的 IP 地址
From 浏览器用户的 E-mail 地址
Host 接受请求的服务器的主机名和端口号
Referer 包含了当前请求 URI 的文档 URL
UA-Color 提供了与浏览器显示器的显示颜色有关的信息
UA-CPU
UA-Disp
UA-OS
US-Pixels
User-Agent

请求报文特有,他们为服务器提供了一些额外信息,比如浏览器希望接受什么类型的数据.例如下面的 Accept 首部就用来告知服务器浏览器会接受与其请求相符的任意媒体类型:
Accept: */*

- 响应首部

响应报文有自己的首部集,以便为浏览器提供信息(比如说浏览器在与哪种类型的服务器进行交互), 下面 Server 首部就用来告知浏览器它在与一个1.0的 Tiki-Hut/1.0服务器进行交互:
Server: Tiki-Hut/1.0

- 实体首部,描述主体的内容和长度,或者资源自身

用于应对实体主体部分的首部.可以用实体首部来说明实体主体部分的数据类型.可以用过Content-Type 首部告知应用程序,数据是以 iso-latin-1字符集比啊使得 HTML 文档:
Content-Type: text/html;charset=iso-latin-1

有很多首部都可以用来描述 http 报文的负荷.由于请求和响应报文中都可能包含实体部分,所以在这两种类型的报文中都可能出现这些首部
实体首部提供了有关实体及其内容的大量信息,从有关对象类型,到能够对资源使用的各种有效的请求方法.总之,实体首部可以告知
Allow 列出了可以对此实体执行的请求方法
Location 告知浏览器实体实际上位于何处,用于将接收端定向到资源的(可能是新的)URL 上去

1. 内容首部

提供了与实体内容有关的特定信息,说明了其类型,尺寸以及处理他所需的其他有用信息.比如说,浏览器可以通过查看返回的内容类型,得知如何显示对象.
Content-Base 解析主体中的相对 URL 时使用的基础 URL
Content-Encoding 对主体执行的任意编码方式
Content-Language

2. 实体缓存首部

通用的缓存首部说明了如何或者什么时候进行缓存.实体的缓存首部提供了与被缓存实体有关的信息--比如,验证已缓存的资源副本是否仍然有效所需的信息,以及更好地估计已缓存资源何时失效所需的线索
第7章很土讨论 http 请求和响应的缓存,在那里我们会再次看到这些首部
ETag 与此实体相关的实体标记
Expires 实体不再有效,要从原始的源端再次获取此实体的日期和时间
Last-Modified 这个实体最后一次被修改的日期和时间

- 扩展首部,规范中没有定义的新首部

非标准的首部,由应用程序开发者创建,但是还未添加到已批准的 http 规范中去.即使不知道这些扩展首部的含义,http 程序也要接受它们并对其进行转发.
###实体主体部分
http 报文的第三部分是可选的实体主体部分,实体的主体是 http 要传输的内容.

#第4章连接管理
http 是如何使用 TCP 连接的;
TCP 连接的时延,瓶颈,存在的障碍;
http 的优化,包括并行连接,keep-alive(持久连接),管道化连接;
管道连接时应该以及不应该做的事情;
##TCP 连接
世界上几乎所有的 http 通信都是由 TCP/IP 承载的;TCP/IP 是全球计算机及网络设备都在使用的一种常用分组交换网络分层协议集.
###TCP 流分段,由 IP 分组传送
TCP 数据是通过IP 分组(数据报)的小数据块来发送的.这样的话,http over TCP over IP 这个协议栈中的最顶层.安全版本 https 就是在 http 和 TCP 之间加了一个成为 TLS 或者 SSL的密码加密层.

http 应用层
TSL SSL 安全层
TCP 传输层
IP 网络层
网络接口 数据链路层

http 要传送一个报文时,会以流的形式将报文数据的内容通过一条打开的 TCP 连接按序传输.TCP 收到数据流之后,会将数据流砍成被称作段的小数据块,并将段封装在 IP 分组中,通过因特网传输,所有这些工作都是由 TCP/IP 软件处理,http 程序员看不到什么.
每个 TCP 段都是由 IP 分组来承载,从一个 IP 地址发送到另一个 IP 地址的.每个 IP 分组中都包括:
一个 IP 分组首部(20字节)
一个 TCP 分组首部(20字节)
一个 TCP 数据块(0或者多字节)

IP 首部包含了源,目的 IP 地址,长度和其他一些标记.TCP 段的首部包含了 TCP 端口号,TCP 控制标记,以及用于数据排序和完整性检查的一些数字值.

###保持 TCP 连接的正确运行
每时每刻计算机界都可以有几条 TCP 连接处于打开状态.TCP 是通过端口号来保持所有这些连接的正确运行.
TCP 连接是通过4个值来识别的:
<源 IP 地址,源端口号,目的 IP 地址,目的端口号>

这4个值唯一地定义了一条连接.两条不同的 TCP 连接不能拥有4个完全相同的地址组件值.
###用 TCP 套接字编程
这个套接字 API 向 http 程序员隐藏了TCP 和 IP 的所有细节.套接字 API 最初是为 Unix 操作系统开发,但是现在几乎所有的操作系统和语言中都有其变体存在.

##对 TCP 性能的考虑
###聚焦区域
TCP 连接建立握手
TCP 蛮启动拥塞机制
数据聚焦的 Nagle 算法
用于捎带确认的 TCP 延迟确认算法;
TIME_WAIT 时延和端口耗尽

TCP 连接握手需要经过以下几个步骤:
1.请求新的 TCP 连接时,浏览器需要向服务器发送一个小的 TCP 分组(40-60个字节),这个分组中设置了一个特殊的 SYN 标记,说明这是一个连接请求.
2.如果服务器接受了连接,就会对一些连接参数进行计算,并向浏览器发送一个 TCP 分组,这个分组中的 SYN 和 ACK标记被置位,说明连接请求已被接受.
3.最后,浏览器向服务器会送一条确认信息,通知他连接已成功建立,现代的 TCP 栈都允许浏览器在这个确认分组中发送数据.
http 程序员永远不会看到这些分组--都由 TCP/IP 软件管理,对其不可见.http 程序员看到的只是创建 TCP 连接时存在的时延.

- 第二部分: http 结构

#第5章 web 服务器结构
###5.8.3 重定向
Web 服务器有时会返回重定向响应而不是成功的报文.web 服务器可以将浏览器重定向到其他地方来执行请求.响应状态码3XX,Location 首部包含了内容的新地址或者优选地址的 URI.重定向可以用于下列情况:

- 永久删除的资源

资源有可能被移走到新位置或者新命名,于是有了一个新的 URL.

- 临时删除的资源

如果资源被临时移走或者重命名,服务希望浏览器将来还可以重新使用老的 URL,那么可以使出303或者307

- 负载均衡

一个超载服务器收到一条请求时,可以将浏览器重定向到一个负载不太重的服务器上去.303See Other和307 Temporary Redirect 可用于此类重定向.

- 服务器关联

服务器可能会有某些用户的本地信息,可以讲浏览器重定向到包含了那个浏览器信息的服务器上去.;303 和307...

- 规范目录名称

浏览器请求的 URI 是一个不带尾部斜线的目录名时,大多数服务器都会讲浏览器重定向到一个加了斜线的 URI 上去,这样相对链接就可以正常工作了--这个问题我在 segmentfault 上面做过笔记的...




#第6章 http 代理服务器,连接 http 浏览器的中间服务器,是 http 服务和控制的平台

Web proxy Server 是网络的中间实体,位于浏览器和服务器之间,在各端点之间来回传送 http 报文.本章介绍了所有与 http 代理服务器有关的内容.为代理特性提供的特殊支持,以及使用代理服务器时会遇到的问题.

阐述 http 代理,将其与 web 网关进行对比,并说明如何部署代理;
给出一些代理所能提供的帮助;
说明在现实网络中是怎样部署代理以及如何将网络流量导向代理服务器;
说明如何配置浏览器来使用代理;
展示了 http 代理请求,说明它们与服务器请求的区别,以及代理如何微妙地改变浏览器行为;
解释如何通过 via 首部和 trace 方法来记录报文传输路径上的代理服务器链;
描述基于代理的 http 访问控制方法;
解释代理如何与浏览器和服务器进行交互;

####http代理服务器既是 web 服务器又是 web 浏览器,http 浏览器回想代理发送请求报文,代理服务器必须想 Web 服务器一样,正确的处理请求和连接,然后返回响应.同时,代理自身要向服务器发送请求,这样的话行为就必须想正确的 http 浏览器一样,要发送请求并接受响应,如果要创建 http 代理,就必须遵守浏览器和服务器的一些条律.

###私有和公共代理
代理服务器可以是某个浏览器专用,也可以是很多浏览器专享.单个浏览器专用的代理是私有代理...

大多数都是公共代理,集中式代理费效比更高,也更易管理.某些代理应用,比如高速缓存代理服务器会利用用户间共同的请求,汇入同一个代理服务器的用户越多,他就越有用.

###代理与网关的对比
代理连接的是两个或者多个使用相同协议的应用程序,而网关连接的则是两个或者多个使用不同协议的端点.网关是协议转换器的角色,即时浏览器和服务器使用的是不同的协议,浏览器也可以通过它完成与服务器之间的事务处理.
代理,浏览器,服务器之间使用的都是相同的协议;
http/pop 网关把 http 前台和 popE-mail 后端连接起来,网关则将 web 食物转换成适当的 pop 事务,这样用户就可以通过 http 读取 E-mail 了;
但是有时候,代理和网关之间的区别比较模糊,由于浏览器和服务器实现的是不同版本的 http,代理也经常要做一些协议转换工作,商业化代理服务器也会实现网关功能来支持 SSL 安全协议,SOCKS 防火墙,FTP 访问,基于 web 的应用程序.
##为什么使用代理
可以改善安全性,提高性能,节省费用.代理服务器还可以接触到所有流过的 http 流量,所以代理可以监视流量并对其进行修改,以实现很多有用的增值 Web 服务.

- 使用过滤器代理来阻止学生访问成人内容

- Web 缓存

代理缓存维护了常用文档的本地副本,并将它们按需提供,以减少缓慢且昂贵的因特网通信.

- 反向代理

代理可以假扮 Web 服务器,这些被称作替代品或者反向代理的代理接收发给 Web 服务器的真实请求,但是与 Web 服务器不同的是,他们可以发起与其它服务器的通信,以便按需定位所请求的内容.

可以用这些反向代理来提高慢速 Web 服务器上公共内容时的性能,在这种配置中,通常将这些反向代理称为服务器加速器.还可以将替代品和内容路由功能配合使用,以创建按需复制内容的分布式网络.

- 内容路由器

根据流量状况以及内容类型将请求导向特定的 Web 服务器.
也可以用来实现各种服务器的请求,比如如果用户或者内容提供者付费要求提供更好的性能,a内容路由器可以将请求转发到附近的复制缓存,或者如果用户申请了过滤服务,还可以通过过滤代理来转发 http 请求,可以用自适应内容路由代理来构建很多有趣的服务.

- 转码器

代理服务器在将内容发送给浏览器之前,可以修改内容的主体格式.在这些数据表示法之间进行的透明转换被称为转码.

- 匿名访问(like chrome)

匿名代理会主动从 http 报文中删除身份特性(比如浏览器 IP 地址,From 首部,Referer 首部,Cookie,URI 的会话 ID),从而提供高度的私密性和匿名性
匿名代理会对用户报文进行下列修改以增加私密性:
1.从 UA 首部删除用户的计算机与 OS 类型;
2.删除From 首部以保护用户的 Email 地址
3.删除 Regerer 首部来掩盖用户访问过的其他站点
4.删除 Cookie 首部以剔除概要信息和身份数据

- 反向代理

部署在网络边缘,在 Web 服务器之前,作为替代品使用,他们可以处理所有传送给 Web 服务器的请求,并只要在必要时向 web 服务器请求资源,替代品可以提高 Web 服务器的安全性,或者将快速的 Web 服务器缓存放在较慢的服务器之前,以提高性能.反向代理通常会直接冒用 Web 服务器的名字和 IP 地址,这样所有的请求就会被发送给代理而不是服务器.

- 网络交换代理

可以将居右足够处理能力的代理放在网络之间的因特网对等交换点上.通过缓存来减轻因特网节点的拥塞,并对流量进行监视.

###代理的层次结构
通过它将代理级联起来,将报文从一个代理传给另一个代理,知道最终抵达原始服务器为止(然后通过代理传回给浏览器)
####内容路由
- 负载均衡

子代理可能会根据当前父代理上的工作负载级别来决定如何选择一个父代理,以均衡负载.

- 地理位置附近的路由

子代理可能会选择负责原始服务器所在物理区域的父代理.

- 协议/类型路由

子代理可能会根据 URI 将报文转发到不同的父代理和原始服务器上去.某些特定类型的 URI 可能要通过一些特殊代理服务器转发请求,以便进行特殊的协议处理.

- 基于订购的路由

如果发布者为高性能服务额外付费了,它们的 URI 就会被转发到大型缓存或者压缩引擎上去,以提高性能.

#第7章 Web 缓存机制,是通过对常用文档进行本地复制来提高性能,减少流量的设备

作用:
减少冗余数据的传输-节省流量费
缓解了网络瓶颈问题-不需要更多带宽就能更快加载出页面
降低了对服务器的要求-服务器响应可以更快,避免过载的出现
减少了距离时延-如果从较远的地方加载页面会更慢一些

待会会阐述缓存是怎样提高性能降低费用的,如何衡量其有效性以及将缓存置于何处可以发挥它的最大作用,我们还会解释 http 如何保持已缓存副本的新鲜度,缓存如何与其它缓存和服务器通信...

#第8章 介绍一些应用程序,http 可以与使用不同协议(比如 SSL 加密协议)的软件进行互操作
#第9章 web 浏览器
#第10章 http 未来发展,特别介绍了HTTP-NG 技术.
模块化modularize + 功能增强 enhancement

- 报文传输层

关心报文的有效传输,不考虑报文的含义和目的,为报文传输提供了一个 API,无论底层实际采用的事什么网络协议栈都可以使用.
本层关注的是提高报文传输的性能:
对报文进行管道化和批量化传输,以降低往返时延;
重用连接,以降低时延,提高传输带宽;
在同一条连接上并行地复用多个报文流;
对报文进行有效的分段,使报文边界的确定更加容易.

- 远程调用

http-ng 结构的中间层提供了对远程方法调用的支持.本层提供了通用的请求/响应框架,浏览器可通过此框架调用对服务器资源的操作.浏览器可通过此框架调用对服务器资源的操作,本层并不关心特定操作的实现及语义(缓存,安全性,方法逻辑...),他只关心允许浏览器远程调用服务器操作的接口.


#第11章 浏览器识别与 Cookie 机制

用户识别机制:
承载用户身份信息的 http 首部;
浏览器 IP 地址跟踪,通过用户的 IP 地址对其进行识别;
用户登录,用认证方式来识别用户;
胖 URL,一种在 URL 中嵌入识别信息的技术;
Cookie,一种功能强大且高效的持久身份识别技术.

##http 首部
from 首部包含了用户的 email 地址.每个用户都有不同的 email 地址,所在在理想情况下,可以将这个地址作为可行的源端来识别用户.由于担心那些不讲道德的服务器会搜集 email 进行垃圾邮件的散发,所以很少有浏览器发送 From 首部,实际上,From 首部是由爬虫发送的...
User-Agent 首部可以将用户所用浏览器的相关信息告知服务器,包括程序的名称和版本,通常还包含操作系统的相关信息,要实现定制内容与特定浏览器及其属性间的良好互操作时,这个首部非常有用,但是他并没有为识别特定的用户提供太多有意义的帮助.
Referer 首部提供了用户来源页面的 URL,他自身并不能完全标识用户,但是他确实说明了用户之前访问过哪个页面.通过它可以更好了解用户浏览行为和兴趣所在.比如你从一个篮球网站抵达某个服务器...
From,User-Agent,Referer 首部都不足以实现可靠的识别,后面的小结对识别特定用户的策略进行了更为详细的讨论.

#### Cookie 如何工作
cookie 就像服务器给用户贴的"Hi, my name is"的贴纸一样.用户访问一个 web 站点时,这个 web 站点就可以读取那个服务器贴在用户身上的所有贴纸.

用户首次访问 Web 站点时服务器对用户一无所知.Web 服务器希望这个用户会再次回来,所以想给这个用户'拍上'一个独有的 Cookie,这样以后他就可以识别出这个用户.Cookie 是一个 key-val 表.


# 第12章 基本认证机制
401 unauthorized
Hi all
    在url中加入参数um_flow_type=gzh  用来识别U盟公众号的链接，需要去掉跟谁学logo，
    Cookie —> key:um_flow_type 有效期5小时
尼瑪倆個字都是繁體的

cache缓存 分享 -- 我一定要结合Charles来讲解。。。各个重点。。。缓存作用，，各个参数优先级如何判定。。。