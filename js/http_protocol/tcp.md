TCP的三次握手和四次挥手

三次握手的过程：
1）第一次握手：客户端向服务端发送连接请求报文，报文发送后客户端进入*SYN-SENT状态*

2）第二次握手：服务端收到连接请求报文段后，如果同意连接则会发送一个应答，发送后进入SYN-*RECEIVED*状态

3）第三次握手：*当客户端收到连接同意的应答后，还要向服务端发送一个确认报文*。客户端发完这个报文段后，进入*ESTABLISHED已建立* 状态，服务端收到这个应答后也进入 ESTABLISHED 状态，此时连接建立成功。


*为何需要三次握手？*
*三次，是保证client和server都让对方知道，自己的接收和发送能力没问题，的最小次数，两次不安全，四次就浪费资源了。*


作者：海阔_天空
链接：https://juejin.cn/post/7146996646394462239
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

*四次挥手的过程*

当服务端收到客户端关闭报文时，并不会立即关闭，而是先回复一个报文告诉客户端，"你发的*FIN报文*我收到了"。*只有等到我Server端所有报文都发送完了，我才能发送连接释放的请求*。因此不能一起发送，所以需要四步挥手。

举例：
Browser:先告诉服务器 “我数据都发完了，你可以关闭连接了。”，Server:回复浏览器 “关闭的请求我收到了，我先看看我这边还有没有数据没传完。”Server:确认过后，再次回复浏览器 “我这边数据传输完了，你可以关闭连接了。”

Browser:告诉服务器 “好的，那我关闭了。不用回复了。”
*客户端又等了2MSL，确认确实没再收到请求，才会真的关闭TCP连接*。

*为何需要四次挥手*？

1）TCP 使用四次挥手的原因，是因为 *TCP 的连接是全双工的，需要双方分别释放掉对方的连接*。

2）单独一方的连接释放，只代表不能再向对方发送数据，连接处于半释放状态。

3）*最后一次挥手中，客户端会等待一段时间再关闭的原因，是为了防止，客户端发送给服务器的确认报文段丢失或出错，从而导致服务端不能正常关闭*。

啥是2MSL？
*MSL是Maximum Segment Lifetime报文最大生存时间*

*四次挥手后，为何客户端最后还要等待2MSL？*

1）保证客户端发送的最后一个ACK报文能到达服务器，因为这个ACK报文可能丢失，如果服务端没收到，那服务端就会重发一次。而客户端就能在这个2MSL时间内收到这个重传的报文，接着给出回应报文，并且会重启2MSL计时器。

2）防止“已失效的连接的请求报文段”出现在新连接中。
客户端发送完最后一个确认报文后，在这个2MSL时间中，就可以使本连接，持续地产生的所有报文都从网络中消失，这样新连接中就不会出现旧连接的请求报文。


TCP的三次握手和四次挥手

TCP的三次握手和四次挥手及常见面试题:https://link.juejin.cn/?target=https%3A%2F%2Fblog.csdn.net%2Fqq_38128179%2Farticle%2Fdetails%2F102561469
什么是2MSL


作者：海阔_天空
链接：https://juejin.cn/post/7146996646394462239
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
